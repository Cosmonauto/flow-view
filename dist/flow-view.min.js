!function e(t,n,i){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,(function(e){return o(t[a][1][e]||e)}),l,l.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?d(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),e}Object.defineProperty(n,"__esModule",{value:!0}),n.FlowViewCanvas=n.FlowViewSvgLayer=n.FlowViewInspector=n.FlowViewCreator=n.FlowViewNode=n.FlowViewNodeInspector=n.FlowViewNodeTextEditor=n.FlowViewEditNumPin=n.FlowViewNodeText=n.FlowViewNodeContent=n.FlowViewLink=n.FlowViewPinBar=n.FlowViewOutput=n.FlowViewInput=n.FlowViewPin=n.FlowViewBox=n.FlowViewGroup=n.FlowViewComponent=void 0;var g=function(){function e(t){var n=t.container,i=t.id;f(this,e);var o=this.constructor.name;n.classList.add(o),Object.defineProperties(this,{boundingClientRect:{get:function(){return n.getBoundingClientRect()}},container:{value:n},isHighlighted:{get:function(){return n.classList.contains("".concat(o,"--highlighted"))}},style:{value:window.getComputedStyle(n)}}),"string"==typeof i&&(n.id=i,Object.defineProperty(this,"id",{value:i}))}return p(e,[{key:"appendChild",value:function(e){return this.container.appendChild(e)}},{key:"createElement",value:function(e){return this.appendChild(document.createElement(e))}},{key:"createSvgElement",value:function(e){return this.appendChild(document.createElementNS("http://www.w3.org/2000/svg",e))}},{key:"dispose",value:function(){this.container.remove()}},{key:"generateId",value:function(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,4)}},{key:"highlight",value:function(e){var t=this.container,n=this.constructor.name;e?t.classList.add("".concat(n,"--highlighted")):t.classList.remove("".concat(n,"--highlighted"))}}]),e}();n.FlowViewComponent=g;var w=function(e){function t(e){var n,i,o,r=e.container,a=e.id,s=e.position,u=void 0===s?{x:0,y:0}:s;return f(this,t),n=c(this,l(t).call(this,{container:r,id:a})),Object.defineProperties(d(n),{position:{get:function(){return{x:i,y:o}},set:function(e){var t=e.x,n=e.y;i=t,o=n,r.setAttribute("transform","translate(".concat(i,",").concat(o,")"))}}}),n.position=u,n}return h(t,g),p(t,[{key:"translate",value:function(e){var t=this.position,n=t.x,i=t.y;this.position={x:n+e.x,y:i+e.y}}}]),t}();n.FlowViewGroup=w;var y=function(e){function t(e){var n,i=e.container,o=e.dimension,r=e.id,a=e.position,s=void 0===a?{x:0,y:0}:a;return f(this,t),n=c(this,l(t).call(this,{container:i,id:r})),Object.defineProperties(d(n),{dimension:{get:function(){return{width:Number(i.getAttribute("width")),height:Number(i.getAttribute("height"))}},set:function(e){var t=e.width,n=e.height;i.setAttribute("width",t),i.setAttribute("height",n)}},position:{get:function(){return{x:Number(i.getAttribute("x")),y:Number(i.getAttribute("y"))}},set:function(e){var t=e.x,n=e.y;i.setAttribute("x",t),i.setAttribute("y",n)}}}),n.dimension=o,n.position=s,n}return h(t,g),t}();n.FlowViewBox=y;var m=function(e){function t(e){var n,i=e.container,o=e.dimension,r=e.id,a=e.index,s=e.node,u=e.position;return f(this,t),n=c(this,l(t).call(this,{container:i,dimension:o,id:r,position:u})),Object.defineProperties(d(n),{index:{value:a},node:{value:s}}),i.addEventListener("mouseenter",(function(){return n.highlight(!0)})),i.addEventListener("mouseleave",(function(){return n.highlight(!1)})),n}return h(t,y),t}();n.FlowViewPin=m;var x=function(e){function t(e){var n,i=e.container,o=e.dimension,r=e.inputJson,a=e.index,s=e.node,u=e.position;f(this,t),n=c(this,l(t).call(this,{container:i,dimension:o,id:r.id,index:a,node:s,position:u}));var h=s.canvas,v=null;return Object.defineProperties(d(n),{connect:{value:function(e){(v=e).to=n.id,v.targetPoint=s.inputCenter(n.index)}},disconnect:{value:function(){v.to=null,v=null}},link:{get:function(){return v}},isConnected:{get:function(){return null!==v}}}),i.addEventListener("mousedown",(function(e){if(e.stopPropagation(),n.isConnected)h.halfConnectedLink=n.link,n.disconnect(),h.dragStart(e);else{var t=n.node.inputCenter(n.index);v=h.createLink({to:n.id},{sourcePoint:t,targetPoint:t}),h.halfConnectedLink=v,h.dragStart(e)}})),i.addEventListener("mouseup",(function(e){e.stopPropagation();var t=h.halfConnectedLink;t&&!t.hasTarget&&n.connect(t)})),n}return h(t,m),p(t,[{key:"dispose",value:function(){this.isConnected&&this.link.dispose(),u(l(t.prototype),"dispose",this).call(this)}}]),t}();n.FlowViewInput=x;var b=function(e){function t(e){var n,i=e.container,o=e.dimension,r=e.outputJson,a=e.index,s=e.node,u=e.position;f(this,t),n=c(this,l(t).call(this,{container:i,dimension:o,id:r.id,index:a,node:s,position:u}));var h=s.canvas,v=new Set;return Object.defineProperties(d(n),{connect:{value:function(e){e.from=n.id,e.sourcePoint=s.outputCenter(n.index),v.add(e)}},disconnect:{value:function(e){e.from=null,v.remove(e)}},links:{get:function(){return v}},isConnected:{get:function(){return v.size>0}}}),i.addEventListener("mousedown",(function(e){e.stopPropagation();var t=n.node.outputCenter(n.index),i=h.createLink({from:n.id},{sourcePoint:t,targetPoint:t});n.links.add(i),h.halfConnectedLink=i,h.dragStart(e)})),i.addEventListener("mouseup",(function(e){e.stopPropagation();var t=h.halfConnectedLink;t&&!t.hasSource&&n.connect(t)})),n}return h(t,m),p(t,[{key:"dispose",value:function(){this.isConnected&&this.links.forEach((function(e){return e.dispose()})),u(l(t.prototype),"dispose",this).call(this)}}]),t}();n.FlowViewOutput=b;var E=function(e){function t(e){var n,i=e.container,o=e.dimension,r=e.id,a=e.position;return f(this,t),n=c(this,l(t).call(this,{container:i,id:r,position:a})),Object.defineProperties(d(n),{rect:{value:new y({container:n.createSvgElement("rect"),dimension:o})}}),n}return h(t,w),t}();n.FlowViewPinBar=E;var k=function(e){function t(e){var n,i=e.canvas,o=e.container,r=e.linkJson,a=e.sourcePoint,s=void 0===a?{x:0,y:0}:a,u=e.targetPoint,h=void 0===u?{x:0,y:0}:u;f(this,t),n=c(this,l(t).call(this,{container:o,id:r.id}));var v=s.x1,p=s.y1,g=s.x2,w=s.y2,y=r.from,m=r.to;return Object.defineProperties(d(n),{canvas:{value:i},from:{get:function(){return y},set:function(e){y=e}},line:{value:n.createSvgElement("line")},hasSource:{get:function(){return"string"==typeof y}},hasTarget:{get:function(){return"string"==typeof m}},sourcePoint:{get:function(){return s},set:function(e){var t=e.x,i=e.y;v=t,p=i,n.line.setAttribute("x1",v),n.line.setAttribute("y1",p)}},targetPoint:{get:function(){return h},set:function(e){var t=e.x,i=e.y;g=t,w=i,n.line.setAttribute("x2",g),n.line.setAttribute("y2",w)}},to:{get:function(){return m},set:function(e){m=e}}}),n.sourcePoint=s,n.targetPoint=h,o.addEventListener("click",(function(e){return e.stopPropagation()})),o.addEventListener("mousedown",(function(e){e.stopPropagation(),i.selectLink({multiSelection:e.shiftKey,link:d(n)})})),o.addEventListener("mouseup",(function(e){return e.stopPropagation()})),n}return h(t,g),p(t,[{key:"dispose",value:function(){this.canvas.links.delete(this.id),u(l(t.prototype),"dispose",this).call(this)}}]),t}();n.FlowViewLink=k;var P=function(e){function t(){return f(this,t),c(this,l(t).apply(this,arguments))}return h(t,y),p(t,[{key:"updateContent",value:function(){}}]),t}();n.FlowViewNodeContent=P;var C=function(e){function t(e){var n,i=e.container,o=e.dimension,r=e.position,a=e.text;return f(this,t),n=c(this,l(t).call(this,{container:i,dimension:o,position:r})),Object.defineProperties(d(n),{div:{value:new g({container:n.createElement("div")})}}),n.div.container.innerHTML=a,n}return h(t,P),p(t,[{key:"updateContent",value:function(e){this.div.container.innerHTML=e.text}}]),t}();n.FlowViewNodeText=C;var L=function(e){function t(e){var n,i=e.container,o=e.setValue,r=e.value;return f(this,t),n=c(this,l(t).call(this,{container:i})),i.type="number",i.min=0,i.value=r,i.addEventListener("blur",(function(e){!function(e){if(""!==e.trim()){var t=Math.round(e);e<0?i.value=r:(r=t,o(t))}else i.value=r}(e.target.value)})),i.addEventListener("keypress",(function(e){var t=e.key;switch(e.target,t){case"Enter":i.blur()}})),n}return h(t,g),t}();n.FlowViewEditNumPin=L;var O=function(e){function t(e){var n,i=e.container,o=e.submit,r=e.value;return f(this,t),n=c(this,l(t).call(this,{container:i})),i.type="text",i.value=r,i.addEventListener("blur",(function(e){var t=e.target.value.trim();""!==t&&o(t)})),i.addEventListener("keypress",(function(e){var t=e.key;switch(e.target,t){case"Enter":i.blur()}})),n}return h(t,g),t}();n.FlowViewNodeTextEditor=O;var S=function(e){function t(e){var n,i=e.container,o=e.node;f(this,t),n=c(this,l(t).call(this,{container:i}));var r=new g({container:n.createElement("div")}),a=r.createElement("label");a.style.display="block",a.innerHTML="Text",a.for="text";var s=new O({container:r.createElement("input"),submit:function(e){o.text=e},value:o.text}),u=new g({container:n.createElement("div")});u.createElement("label").innerHTML="Inputs";var h=new g({container:u.createElement("div")}),v=new L({container:h.createElement("input"),setValue:function(e){for(var t=o.inputs.size,n=e;n<t;n++)o.deleteInput();for(var i=t;i<e;i++)o.createInput()},value:o.inputs.size}),p=new g({container:n.createElement("div")});p.createElement("label").innerHTML="Outputs";var w=new g({container:p.createElement("div")}),y=new L({container:w.createElement("input"),setValue:function(e){for(var t=o.outputs.size,n=e;n<t;n++)o.deleteOutput();for(var i=t;i<e;i++)o.createOutput()},value:o.outputs.size}),m=n.createElement("button");return m.innerHTML="Delete",m.addEventListener("click",(function(e){e.preventDefault(),o.dispose(),n.dispose()})),Object.defineProperties(d(n),{inputsNumEditor:{value:v},outputsNumEditor:{value:y},textInput:{value:s}}),n}return h(t,g),t}();n.FlowViewNodeInspector=S;var j=function(e){function t(e){var n,i=e.canvas,o=e.container,r=e.nodeJson,a=e.NodeContentClass,s=void 0===a?C:a,u=e.NodeInspectorClass,h=void 0===u?S:u;f(this,t);var v=(n=c(this,l(t).call(this,{container:o,id:r.id,position:i.roundPosition(r)}))).createSvgElement("g"),p=n.createSvgElement("foreignObject"),g=n.createSvgElement("g"),w=null,y=r.text;Object.defineProperties(d(n),{NodeContentClass:{value:s},NodeInspectorClass:{value:h}}),Object.defineProperties(d(n),{attachInspector:{value:function(e){var t=new h({container:e.createElement("div"),node:d(n)});w=t}},canvas:{value:i},content:{value:n.spawnContent({canvas:i,container:p,nodeJson:r})},detachInspector:{value:function(){w.dispose(),w=null}},inputs:{value:new Map},inspector:{get:function(){return w}},outputBarPosition:{get:function(){var e=n.content.dimension.height;return{x:0,y:i.gridUnit+e}}},outputs:{value:new Map},pinBarDimension:{get:function(){return{width:n.content.dimension.width,height:i.gridUnit}}}});var m=function(e){var t=e.index,n=e.width,i=e.height,o=e.num;return 0===t?0:t*(n-i)/(o-1)};return Object.defineProperties(d(n),{inputBar:{value:new E({container:v,dimension:n.pinBarDimension})},inputPosition:{value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.inputs.size,i=n.pinBarDimension,o=i.width,r=i.height;return{x:m({index:e,width:o,height:r,num:t}),y:0}}},outputBar:{value:new E({container:g,dimension:n.pinBarDimension,position:n.outputBarPosition})},outputPosition:{value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.outputs.size,i=n.pinBarDimension,o=i.width,r=i.height;return{x:m({index:e,width:o,height:r,num:t}),y:0}}}}),Object.defineProperties(d(n),{inputCenter:{value:function(e){var t=d(n),i=t.inputPosition,o=t.pinBarDimension,r=t.position,a=o.height/2,s=i(e);return{x:r.x+s.x+a,y:r.y+s.y+a}}},outputCenter:{value:function(e){var t=d(n),i=t.outputBarPosition,o=t.outputPosition,r=t.pinBarDimension,a=t.position,s=r.height/2,u=o(e);return{x:a.x+u.x+s,y:a.y+u.y+i.y+s}}}}),Object.defineProperties(d(n),{text:{get:function(){return y},set:function(e){y=e,n.content.updateContent(n.json)}}}),Object.defineProperty(d(n),"json",{get:function(){var e=d(n),t=e.id,i=e.position,o=i.x,r=i.y;return{id:t,outs:[],ins:[],text:e.text,x:o,y:r}}}),o.addEventListener("click",(function(e){e.stopPropagation(),i.dragEnd()})),o.addEventListener("mousedown",(function(e){e.stopPropagation(),i.selectNode({multiSelection:e.shiftKey,node:d(n)}),i.dragStart(e)})),n}return h(t,w),p(t,[{key:"createInput",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.canvas.gridUnit,n=this.generateId,i=this.inputBar,o=this.inputPosition,r=this.inputs,s=r.size;r.forEach((function(e){e.position=o(e.index,s+1)}));var u=s,c=o(u,s+1),l=new x({container:i.createSvgElement("rect"),dimension:{width:t,height:t},index:u,inputJson:a({id:n()},e),node:this,position:c});return r.set(l.id,l),l}},{key:"createOutput",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.canvas.gridUnit,n=this.generateId,i=this.outputBar,o=this.outputs,r=this.outputPosition,s=o.size;o.forEach((function(e){e.position=r(e.index,s+1)}));var u=s,c=r(u,s+1),l=new b({container:i.createSvgElement("rect"),dimension:{width:t,height:t},index:u,node:this,outputJson:a({id:n()},e),position:c});return o.set(l.id,l),l}},{key:"deleteInput",value:function(){var e=this.inputs,t=e.size-1;e.forEach((function(n){n.index===t&&(e.delete(n.id),n.dispose())}))}},{key:"deleteOutput",value:function(){var e=this.outputs,t=e.size-1;e.forEach((function(n){n.index===t&&(e.delete(n.id),n.dispose())}))}},{key:"dispose",value:function(){this.inputs.forEach((function(e){e.isConnected&&e.link.dispose()})),this.outputs.forEach((function(e){e.isConnected&&e.links.forEach((function(e){return e.dispose()}))})),this.canvas.nodes.delete(this.id),u(l(t.prototype),"dispose",this).call(this)}},{key:"spawnContent",value:function(e){var t=e.canvas,n=e.container,i=e.nodeJson,o=this.NodeContentClass,r=i.text,a=i.width,s=void 0===a?0:a,u=i.height,c=void 0===u?0:u,l=t.roundDimension(t.textRuler.sizeOfText(r+"x")),d=new o({container:n,dimension:{width:Math.max(s,l.width),height:Math.max(c,l.height)},nodeJson:i,position:{x:0,y:t.gridUnit}});return d.updateContent(i),d}}]),t}();n.FlowViewNode=j;var V=function(e){function t(){return f(this,t),c(this,l(t).apply(this,arguments))}return h(t,j),p(t,[{key:"spawnContent",value:function(e){var t=e.canvas,n=e.container,i=e.nodeJson,o=t.roundDimension(t.textRuler.sizeOfText("xxxxxxxxxxxxxxxxx")),r=new y({container:n,dimension:o,position:{x:0,y:t.gridUnit}});return new O({container:r.createElement("input"),submit:function(e){t.createNode({text:e,x:i.x,y:i.y})},value:""}).container.focus(),r}}]),t}();n.FlowViewCreator=V;var F=function(e){function t(){return f(this,t),c(this,l(t).apply(this,arguments))}return h(t,g),p(t,[{key:"sizeOfText",value:function(e){this.container.textContent=e;var t=this.boundingClientRect;return{width:t.width,height:t.height}}}]),t}(),N=function(e){function t(e){var n,i=e.container;f(this,t),n=c(this,l(t).call(this,{container:i}));var o=null;return Object.defineProperties(d(n),{hasInspectedItem:{get:function(){return null!==o}},inspectedItem:{get:function(){return o},set:function(e){o=e}}}),i.addEventListener("click",(function(e){return e.stopPropagation()})),i.addEventListener("mousedown",(function(e){return e.stopPropagation()})),n}return h(t,g),p(t,[{key:"attach",value:function(e){switch(this.hasInspectedItem&&this.inspectedItem.id!==e.id&&this.detach(),!0){case e instanceof V:break;case e instanceof j:this.inspectedItem=e,e.attachInspector(this)}}},{key:"detach",value:function(){this.hasInspectedItem&&(this.inspectedItem.detachInspector(),this.inspectedItem=null)}}]),t}();n.FlowViewInspector=N;var I=function(e){function t(e){var n,i=e.container,o=e.dimension,r=void 0===o?{width:0,height:0}:o,s=e.position,u=void 0===s?{x:0,y:0}:s;f(this,t),n=c(this,l(t).call(this,{container:i,dimension:r,position:u}));var h=1;return Object.defineProperties(d(n),{linksLayer:{value:new g({container:n.createSvgElement("g")})},nodesLayer:{value:new g({container:n.createSvgElement("g")})},viewBox:{get:function(){return Object.assign({},n.position,n.dimension)},set:function(e){var t=e.x,o=void 0===t?n.position.x:t,r=e.y,a=void 0===r?n.position.y:r,s=e.width,u=void 0===s?n.dimension.width:s,c=e.height,l=void 0===c?n.dimension.height:c,d=e.scaleFactor,f=void 0===d?1/h:d;n.position={x:o,y:a},n.dimension={width:u,height:l},i.setAttribute("viewBox","".concat(o," ").concat(a," ").concat(Math.floor(f*u)," ").concat(Math.floor(f*l)))}}}),n.viewBox=a({},u,{},r),i.addEventListener("wheel",(function(e){e.preventDefault(),h+=.001*e.deltaY,h=Math.min(Math.max(.1,h),1),n.viewBox={scaleFactor:1/h}})),n}return h(t,y),p(t,[{key:"translate",value:function(e){var t=this.viewBox,n=t.x,i=t.y;this.viewBox={x:n-e.x,y:i-e.y}}}]),t}();n.FlowViewSvgLayer=I;var M=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.gridUnit,r=void 0===o?10:o,a=i.CreatorClass,s=void 0===a?V:a,u=i.LinkClass,h=void 0===u?k:u,v=i.InspectorClass,p=void 0===v?N:v,g=i.NodeClass,w=void 0===g?j:g;f(this,t);var y,m,x,b=(n=c(this,l(t).call(this,{container:e}))).createElement("div"),E=n.createSvgElement("svg"),P=null,C=null,L=!1,O=!1,S=new p({container:b}),M=function(e){e.inputs.forEach((function(t){t.isConnected&&(t.link.targetPoint=e.inputCenter(t.index))})),e.outputs.forEach((function(t){t.isConnected&&t.links.forEach((function(n){n.sourcePoint=e.outputCenter(t.index)}))}))};return Object.defineProperties(d(n),{closeCreator:{value:function(){n.hasCreator&&(P.dispose(),P=null)}},creator:{get:function(){return P},set:function(e){n.closeCreator(),P=e}},CreatorClass:{value:s},dragEnd:{value:function(){var e=d(n),t=e.halfConnectedLink,i=e.selectedNodes;clearTimeout(x),L=!1,t?(!1!==t.hasTarget&&!1!==t.hasSource||t.dispose(),n.halfConnectedLink=null):i.size>0&&i.forEach((function(e){e.position=n.roundPosition(e.position),M(e)}))}},dragMove:{value:function(e){var t=e.clientX,i=e.clientY,o=d(n),r=o.halfConnectedLink,a=o.selectedNodes,s=o.svgLayer;if(L){if(!1===O&&(O=!0,y=t,m=i),r){var u=n.inspector.boundingClientRect.width,c=n.boundingClientRect,l=c.left,h=c.top,f=n.svgLayer.position,v=y-u-l+f.x,p=m-h+f.y;r.hasTarget&&(r.sourcePoint={x:v,y:p}),r.hasSource&&(r.targetPoint={x:v,y:p})}else a.size>0?a.forEach((function(e){e.translate({x:t-y,y:i-m}),M(e)})):s.translate({x:t-y,y:i-m});y=t,m=i}}},dragStart:{value:function(){clearTimeout(x),O=!1,x=setTimeout((function(){x=null,L=!0}),100)}},fontSize:{get:function(){return parseInt(n.style.fontSize)}},gridUnit:{value:r},halfConnectedLink:{get:function(){return C},set:function(e){C=e}},hasCreator:{get:function(){return null!==P}},inputs:{value:new Map},isDragging:{get:function(){return L}},LinkClass:{value:h},links:{value:new Map},inspector:{value:S},nodes:{value:new Map},outputs:{value:new Map},NodeClass:{value:w},selectedLinks:{value:new Set},selectedNodes:{value:new Set},svgLayerDimension:{get:function(){var e=n.boundingClientRect,t=e.width,i=e.height;return{width:Math.floor(t-S.boundingClientRect.width),height:Math.floor(i)}}},textRuler:{value:new F({container:n.createElement("div")})}}),Object.defineProperties(d(n),{svgLayer:{value:new I({container:E,dimension:n.svgLayerDimension})}}),Object.defineProperties(d(n),{resizeHandler:{value:function(){var e=n.svgLayerDimension,t=e.width,i=e.height;n.svgLayer.viewBox={width:t,height:i}}}}),window.addEventListener("resize",n.resizeHandler),e.addEventListener("dblclick",(function(e){e.stopPropagation();var t=n.svgLayer.position,i=n.svgLayer.boundingClientRect,o=i.x,a=i.y,s=e.clientX,u=e.clientY;n.spawnCreator({x:s-o+t.x,y:u-a+t.y-r})})),e.addEventListener("click",(function(e){e.stopPropagation(),n.clearSelection(),n.dragEnd(),n.closeCreator(),n.inspector.detach()})),e.addEventListener("mousedown",(function(e){e.stopPropagation(),n.clearSelection(),n.dragStart(e)})),e.addEventListener("mouseleave",(function(){L&&n.dragEnd()})),e.addEventListener("mousemove",n.dragMove.bind(d(n))),n}return h(t,g),p(t,[{key:"clearSelection",value:function(){var e=this.selectedNodes,t=this.selectedLinks;t.forEach((function(e){return e.highlight(!1)})),t.clear(),e.forEach((function(e){return e.highlight(!1)})),e.clear()}},{key:"connect",value:function(e){switch(!0){case e instanceof k:return{to:function(t){switch(!0){case t instanceof x:case t instanceof b:t.connect(e)}}};case e instanceof x:case e instanceof b:return{to:function(t){e.connect(t)}};default:console.error("Cannot connect item",e)}}},{key:"createLink",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.LinkClass,i=void 0===n?this.LinkClass:n,o=t.sourcePoint,r=t.targetPoint,s=new i({canvas:this,container:this.svgLayer.linksLayer.createSvgElement("g"),linkJson:a({id:this.generateId()},e),sourcePoint:o,targetPoint:r});return this.links.set(s.id,s),s}},{key:"createNode",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).NodeClass,n=void 0===t?this.NodeClass:t;this.closeCreator();var i=new n({canvas:this,container:this.svgLayer.nodesLayer.createSvgElement("g"),nodeJson:a({id:this.generateId()},e)});return this.nodes.set(i.id,i),i}},{key:"dispose",value:function(){document.removeEventListener("resize",this.resizeHandler)}},{key:"inspect",value:function(e){this.inspector.attach(e)}},{key:"loadGraph",value:function(){}},{key:"roundDimension",value:function(e){var t=e.width,n=void 0===t?0:t,i=e.height,r=void 0===i?0:i,a=o(this.roundVector([n,r]),2);return{width:a[0],height:a[1]}}},{key:"roundPosition",value:function(e){var t=e.x,n=void 0===t?0:t,i=e.y,r=void 0===i?0:i,a=o(this.roundVector([n,r]),2);return{x:a[0],y:a[1]}}},{key:"roundVector",value:function(e){var t=o(e,2),n=t[0],i=t[1],r=this.gridUnit,a=Math.round(n),s=Math.round(i),u=a%r,c=s%r;return[u<=Math.round(r/2)?a-u:a+r-u,c<=Math.round(r/2)?s-c:s+r-c]}},{key:"selectLink",value:function(e){var t=e.multiSelection,n=e.link,i=this.selectedLinks;i.has(n)||(t||this.clearSelection(),n.highlight(!0),i.add(n))}},{key:"selectNode",value:function(e){var t=this,n=e.multiSelection,i=e.node,o=this.selectedNodes;if(!o.has(i)){n||(this.clearSelection(),this.inspect(i)),i.highlight(!0),o.add(i);var r=[],a=[];o.forEach((function(e){e.inputs.forEach((function(e){e.isConnected&&a.push(e.link)})),e.outputs.forEach((function(e){r.push(e.id)}))})),a.forEach((function(e){r.includes(e.from)&&t.selectLink({link:e,multiSelection:n})}))}}},{key:"spawnCreator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.CreatorClass;this.creator=new t({canvas:this,container:this.svgLayer.createSvgElement("g"),nodeJson:e})}}]),t}();n.FlowViewCanvas=M},{}]},{},[1]);
