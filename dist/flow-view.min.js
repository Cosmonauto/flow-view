// http://g14n.info/flow-view
require=function(){return function t(e,n,i){function s(r,d){if(!n[r]){if(!e[r]){var a="function"==typeof require&&require;if(!d&&a)return a(r,!0);if(o)return o(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[r]={exports:{}};e[r][0].call(c.exports,function(t){return s(e[r][1][t]||t)},c,c.exports,t,e,n,i)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)s(i[r]);return s}}()({1:[function(t,e,n){e.exports=n.default=function(t){Array.prototype.slice.call(arguments,1).forEach(function(e){t[e]?t[e]=t[e].bind(t):console.error("Method "+e+" is not defined")})}},{}],2:[function(t,e,n){e.exports=function(t){t.preventDefault(),t.stopPropagation()}},{}],3:[function(t,e,n){var i,s,o=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(t){i=r}try{s="function"==typeof clearTimeout?clearTimeout:d}catch(t){s=d}}();var h,c=[],l=!1,u=-1;function p(){l&&h&&(l=!1,h.length?c=h.concat(c):u=-1,c.length&&g())}function g(){if(!l){var t=a(p);l=!0;for(var e=c.length;e;){for(h=c,c=[];++u<e;)h&&h[u].run();u=-1,e=c.length}h=null,l=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===d||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function f(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new m(t,e)),1!==c.length||l||a(g)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=f,o.addListener=f,o.once=f,o.off=f,o.removeListener=f,o.removeAllListeners=f,o.emit=f,o.prependListener=f,o.prependOnceListener=f,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],4:[function(t,e,n){e.exports=n.default=function(t){return function(e,n){var i={};for(var s in e){var o={configurable:!1,enumerable:n},r=e[s];"function"==typeof r?o.get=r:(o.value=r,o.writable=!1),i[s]=o}Object.defineProperties(t,i)}}},{}],5:[function(t,e,n){const i=t("bindme"),s=t("pdsp"),o=t("static-props");e.exports=class{constructor(t,e,n){o(this)({canvas:t,component:{},container:n,dispatch:()=>e}),i(this,"dropEvent")}createElement(t,e){const n=document.createElement(t);return e?e.appendChild(n):this.container.appendChild(n),n}dropEvent(t){s(t)}hide(){this.container.style.display="none"}render(t){this.renderAllSubComponents(t)}renderAllSubComponents(t){const e=this.component;Object.getOwnPropertyNames(e).forEach(function(n){e[n].render(t)})}show(){this.container.style.display=""}}},{bindme:1,pdsp:2,"static-props":4}],6:[function(t,e,n){const i=t("bindme"),s=t("static-props"),o=t("./SvgComponent");class r extends o{constructor(t,e,n){super(t,e,n),this.hide();const o=this.createElement("input");o.setAttribute("type","text"),o.style.outline="none",s(this)({input:o}),i(this,"onInputKeypress"),o.addEventListener("keypress",this.onInputKeypress)}onInputKeypress(t){const{dispatch:e,input:n,x:i,y:s}=this,o=t.target.value;switch(t.key){case"Enter":e("createNode",{name:o,x:i,y:s}),n.value=""}}render(t){const{canvas:e,container:n,input:i}=this,{hidden:s,x:o,y:r}=t.creator,{fontFamily:d,fontSize:a}=e.theme.frame,h=this.fontSize!==a||this.fontFamily!==d,c=this.hidden!==s;h&&(i.style.fontFamily=d,i.style.fontSize=a),c&&(s?n.style.display="none":(this.x=o,this.y=r,n.setAttribute("x",o),n.setAttribute("y",r),n.style.display="",i.focus()),this.hidden=s)}}s(r)({defaultState:{hidden:!0,x:0,y:0}}),e.exports=r},{"./SvgComponent":19,bindme:1,"static-props":4}],7:[function(t,e,n){const i=t("bindme"),s=t("static-props"),o=t("./Component");e.exports=class extends o{constructor(t,e,n){super(t,e,n);const o=this.createElement("span");o.style.cursor="default";const r=this.createElement("input");r.style.cursor="none",r.style.display="none",i(this,"onBlurEditor","onClickLabel","onKeydownEditor","onMouseLeaveEditor"),r.addEventListener("blur",this.onBlurEditor),r.addEventListener("keydown",this.onKeydownEditor),r.addEventListener("keyup",this.dropEvent),r.addEventListener("mouseleave",this.onMouseLeaveEditor),o.addEventListener("click",this.onClickLabel),s(this)({editor:r,label:o})}onBlurEditor(){this.submit()}onClickLabel(){this.editable&&this.startEditing()}onKeydownEditor(t){switch(t.stopPropagation(),t.key){case"Escape":this.stopEditing();break;case"Enter":this.submit()}}onMouseLeaveEditor(){this.stopEditing()}startEditing(){const{editor:t,label:e,text:n}=this;t.style.display="",e.style.display="none",t.value=n,t.focus()}stopEditing(){const{editor:t,label:e}=this;t.style.display="none",t.value="",e.style.display=""}render(t){const{label:e}=this,{editable:n,text:i}=t;this.editable=n,this.text!==i&&(this.text=i,e.innerHTML=i)}submit(){const{action:t,editor:e}=this,n=e.value.trim();"function"==typeof t&&""!==n&&t(n),this.stopEditing()}}},{"./Component":5,bindme:1,"static-props":4}],8:[function(t,e,n){const i=t("bindme"),s=t("pdsp"),o=t("static-props"),r=t("./SvgComponent"),d=t("./Creator"),a=t("./InspectorToggle"),h=t("./Link"),c=t("./Node"),l=(t,e,n,i)=>Math.sqrt((n-t)*(n-t)+(i-e)*(i-e));e.exports=class extends r{constructor(t,e,n){super(t,e,n),this.linkRef={},this.nodeRef={};const s=this.createElementNS("svg");s.style.cursor="default",this.selectedNodesBounds={};const r=this.createElementNS("rect",s);r.setAttribute("fill","transparent"),r.setAttribute("stroke-dasharray","10 10");const h=this.createElementNS("g",s),c=this.createElementNS("g",s),l=this.createElementNS("foreignObject",s),u=new d(t,e,l),p=this.createElementNS("foreignObject",s),g=new a(t,e,p);o(this)({linksGroup:h,nodesGroup:c,selection:r,svg:s}),o(this.component)({creator:u,inspectorToggle:g}),i(this,"onDblclick","onKeydownDocument","onKeyupDocument","onMousedown","onMouseleave","onMousemove","onMouseup"),document.addEventListener("keydown",this.onKeydownDocument),document.addEventListener("keyup",this.onKeyupDocument),s.addEventListener("dblclick",this.onDblclick),s.addEventListener("mousedown",this.onMousedown),s.addEventListener("mouseleave",this.onMouseleave),s.addEventListener("mouseup",this.onMouseup),s.addEventListener("mousemove",this.onMousemove)}getCoordinates(t){const{left:e,top:n}=this.svg.getBoundingClientRect();return{x:t.clientX-e,y:t.clientY-n}}isCloseToLink(t,e,n){const{linkRef:i}=this,{startX:s,endX:o,startY:r,endY:d}=i[t];return l(e,n,o,d)+l(e,n,s,r)<l(s,r,o,d)+.4}isInsideRectangularSelection(t,e){const{selectedNodesBounds:n}=this;return Object.keys(n).length>0&&t>=n.x1&&t<=n.x2&&e>=n.y1&&e<=n.y2}onDblclick(t){const{dispatch:e,linkRef:n}=this,{creator:i}=this.component,{x:s,y:o}=this.cursorCoordinates=this.getCoordinates(t);let r;return Object.keys(n).forEach(t=>{r||this.isCloseToLink(t,s,o)&&(r=t)}),r?e("deleteLink",r):i.hidden?e("showCreator",{x:s,y:o}):void 0}onKeydownDocument(t){const{dispatch:e}=this;switch(t.key){case"Backspace":e("deleteSelection");break;case"Escape":e("resetSelection");break;case"Shift":e("enableMultiSelection")}}onKeyupDocument(t){const{dispatch:e}=this;switch(t.key){case"Shift":e("disableMultiSelection")}}onMousedown(t){s(t);const{dispatch:e,linkRef:n}=this,{x:i,y:o}=this.cursorCoordinates=this.getCoordinates(t);if(this.isInsideRectangularSelection(i,o))return e("startDraggingItems");let r;if(Object.keys(n).forEach(t=>{r||this.isCloseToLink(t,i,o)&&(r=t)}),r)return e("selectLink",r);e("resetSelection")}onMouseleave(t){const{dispatch:e,draggingItems:n}=this;n&&e("stopDraggingItems")}onMousemove(t){const{cursorCoordinates:e,dispatch:n,draggingLink:i,draggingItems:s,selectedNodesBounds:o}=this;if(s){const i=this.getCoordinates(t);let s={x:i.x-e.x,y:i.y-e.y};o.x1+s.x<=0&&(s.x=0),o.y1+s.y<=0&&(s.y=0),this.cursorCoordinates=i,n("dragItems",s)}i&&n("dragLink",this.getCoordinates(t))}onMouseup(t){s(t);const{dispatch:e,draggingLink:n,draggingItems:i}=this;this.setCursorCoordinates(t);const{x:o,y:r}=this.cursorCoordinates;return i&&this.isInsideRectangularSelection(o,r)?e("stopDraggingItems"):n?e("deleteHalfLink"):void 0}render(t){const{canvas:e,dispatch:n,linksGroup:i,nodesGroup:s,selection:o,svg:r}=this,{currentPin:d,draggingItems:a,draggedLinkCoordinates:l,draggedLinkType:u,draggedLinkId:p,draggingLink:g,graph:m,inspector:f,root:b,textSize:y}=t;this.draggingItems=a,this.draggingLink=g;const k=p?m.links.find(t=>t.id===p):null;this.draggedLink=k;const x=t.selected.links,v=t.selected.nodes,{fontFamily:E,fontSize:C}=e.theme.frame,L=e.theme.pin.size/2,w=b.height,I=f.hidden?b.width:b.width-f.width,S=v.length>1,M=v.length>0?v.map(t=>this.nodeRef[t]).reduce((t,e)=>({x1:Math.min(t.x1,e.x),y1:Math.min(t.y1,e.y),x2:Math.max(t.x2,e.x+e.width),y2:Math.max(t.y2,e.y+e.height)}),{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0}):{},A=this.fontSize!==C||this.fontFamily!==E,O=this.height!==w,N=M.x1!==this.selectedNodesBounds.x1||M.y1!==this.selectedNodesBounds.y1||M.x2!==this.selectedNodesBounds.x2||M.y2!==this.selectedNodesBounds.y2,R=this.width!==I;A&&(r.setAttribute("font-family",E),r.setAttribute("font-size",C)),R&&r.setAttribute("width",I),O&&r.setAttribute("height",w),N&&(this.selectedNodesBounds=M),S?(o.setAttribute("stroke",e.theme.selection.color),N&&(o.setAttribute("x",M.x1),o.setAttribute("y",M.y1),o.setAttribute("height",M.y2-M.y1),o.setAttribute("width",M.x2-M.x1))):o.setAttribute("stroke","transparent"),Object.keys(this.nodeRef).forEach(t=>{m.nodes.find(e=>e.id===t)||(s.removeChild(this.nodeRef[t].container),delete this.nodeRef[t])});const P={},T={};m.links.forEach(({from:t,to:e})=>{if(t){const[e,n]=t;void 0===T[e]?T[e]=[n]:T[e].push(n)}if(e){const[t,n]=e;void 0===P[t]?P[t]=[n]:P[t].push(n)}}),m.nodes.forEach(t=>{const{id:i}=t,o=v.indexOf(i)>-1,r={connectedIns:P[i]||[],connectedOuts:T[i]||[],currentPin:d&&d.nodeId===i?d:null,draggedLink:k,draggedLinkType:u,draggingLink:g,graph:t,selected:o,textSize:y[i]},h=this.nodeRef[i];if(h)o&&!a&&(s.removeChild(h.container),s.appendChild(h.container)),h.render(r);else{const t=this.createElementNS("g",s);t.setAttribute("id",i);const o=new c(e,this,n,t);o.render(r),this.nodeRef[i]=o}}),Object.keys(this.linkRef).forEach(t=>{m.links.find(e=>e.id===t)||(i.removeChild(this.linkRef[t].container),delete this.linkRef[t])}),m.links.forEach(t=>{const{id:s,from:o,to:r}=t,d=o?this.nodeRef[o[0]]:null,a=r?this.nodeRef[r[0]]:null,c=d?d.getOutRefByPosition(o[1]):null,u=a?a.getInRefByPosition(r[1]):null,p=x.indexOf(s)>-1,g={endX:u?a.x+u.x+L:l.x,endY:u?a.y+L:l.y,graph:t,selected:p||d&&a&&d.selected&&a.selected,startX:c?d.x+c.x+L:l.x,startY:c?d.y+c.y+L:l.y},m=this.linkRef[s];if(m)m.render(g);else{const t=this.createElementNS("g",i);t.setAttribute("id",s);const o=new h(e,n,t);o.render(g),this.linkRef[s]=o}}),this.renderAllSubComponents(t)}setCursorCoordinates(t){this.cursorCoordinates=this.getCoordinates(t)}}},{"./Creator":6,"./InspectorToggle":13,"./Link":14,"./Node":15,"./SvgComponent":19,bindme:1,pdsp:2,"static-props":4}],9:[function(t,e,n){const i=t("bindme"),s=t("pdsp"),o=t("./Pin");e.exports=class extends o{constructor(t,e,n,s,o,r){super(t,e,n,s,o,r),i(this,"onMousedown","onMouseover","onMouseup"),s.addEventListener("mousedown",this.onMousedown),s.addEventListener("mouseover",this.onMouseover),s.addEventListener("mouseup",this.onMouseup)}onMousedown(t){s(t),console.log("create link")}onMouseover(t){s(t);const{dispatch:e,nodeId:n,position:i}=this;e("focusPin",{type:"In",nodeId:n,position:i})}onMouseup(t){s(t);const{connected:e,dispatch:n,frame:i,highlighted:o,nodeId:r,position:d}=this;i.draggingLink&&i.draggedLink.from&&(e?n("deleteHalfLink"):o?n("attachHalfLink",{id:i.draggedLink.id,to:[r,d]}):n("deleteHalfLink"))}render(t){super.render(t)}}},{"./Pin":17,bindme:1,pdsp:2}],10:[function(t,e,n){const i=t("bindme"),s=t("static-props"),o=t("./Component"),r=t("./EditableText"),d=t("./InspectorPinList");class a extends o{constructor(t,e,n){super(t,e,n);const o=this.createElement("botton");o.style.cursor="default";const a=this.createElement("div"),h=new r(t,e,a),c=this.createElement("div"),l=new d(t,e,c,"in"),u=this.createElement("div"),p=new d(t,e,u,"out");i(this,"onClickPin","onMouseLeave"),n.addEventListener("mouseleave",this.onMouseLeave),o.addEventListener("click",this.onClickPin),s(this)({inputList:l,outputList:p,label:h,pin:o})}onClickPin(){const t=this.pinned?"unpinInspector":"pinInspector";this.dispatch(t)}onMouseLeave(){this.pinned||this.dispatch("hideInspector")}render(t){const{canvas:e,container:n,dispatch:i,inputList:s,label:o,outputList:r,pin:d}=this,{graph:a,inspector:h,selected:c}=t,{hidden:l,pinned:u,width:p}=h,{baseColor:g}=e.theme.inspector,m=a.nodes.filter(({id:t})=>c.nodes.indexOf(t)>-1),f=m.length,b=this.baseColor!==g,y=this.pinned!==u,k=!u&&this.hidden!==l,x=this.width!==p;if(k&&(this.hidden=l,n.style.display=l?"none":""),!l)if(y&&(this.pinned=u,d.innerHTML=u?"❌":"📌"),b&&(this.baseColor=g,n.style.border=`1px solid ${g}`),x&&(this.width=p,n.style.width=`${p}px`),1===f){const t=m[0];o.action=(e=>{i("renameNode",{id:t.id,name:e})}),o.render({editable:!0,text:t.name}),s.show();const e=t.ins||[];s.render({nodeId:t.id,pins:e}),r.show();const n=t.outs||[];r.render({nodeId:t.id,pins:n})}else delete o.action,s.hide(),s.render({pins:[]}),r.hide(),r.render({pins:[]}),0===f&&o.render({editable:!1,text:"(no node selected)"}),1===f&&o.render({editable:!1,text:`(${f} node)`}),f>1&&o.render({editable:!1,text:`(${f} nodes)`})}}s(a)({defaultState:{hidden:!0,pinned:!1,width:170}}),e.exports=a},{"./Component":5,"./EditableText":7,"./InspectorPinList":12,bindme:1,"static-props":4}],11:[function(t,e,n){const i=t("bindme"),s=t("static-props"),o=t("./Component"),r=t("./EditableText");e.exports=class extends o{constructor(t,e,n){super(t,e,n);const o=this.createElement("div"),d=this.createElement("button",o);d.style.borderRadius="2px",d.style.marginLeft="1px",d.style.marginRight="4px",d.style.outline="none",d.innerHTML="x",this.createElement("div");const a=new r(t,e,o);i(this,"onClickDelete"),n.addEventListener("click",this.onClickDelete),s(this)({label:a})}onClickDelete(){const{dispatch:t,nodeId:e,position:n,type:i}=this;t("deletePin",{type:i,nodeId:e,position:n})}render(t){const{dispatch:e,label:n}=this,{nodeId:i,pin:s,position:o,type:r}=t,{name:d}=s,a=this.name!==d,h=this.nodeId!==i,c=this.position!==o,l=this.type!==r;h&&(this.nodeId=i),c&&(this.position=o),l&&(this.type=r),a&&(n.render({editable:!0,text:d}),this.name=d),(h||c)&&(n.action=(t=>{e("renamePin",{type:r,nodeId:i,position:o,name:t})}))}}},{"./Component":5,"./EditableText":7,bindme:1,"static-props":4}],12:[function(t,e,n){const i=t("static-props"),s=t("./Component"),o=t("./InspectorPinEditor");e.exports=class extends s{constructor(t,e,n,s){super(t,e,n),this.pinEditorRef=[];const o=this.createElement("div"),r=this.createElement("div");this.hide(),i(this)({info:o,pinList:r,type:s})}createPinEditor(t,e){const{canvas:n,dispatch:i,pinList:s}=this,r=this.createElement("div",s),d=new o(n,i,r);d.render(t),this.pinEditorRef.splice(e,0,d)}deletePinEditor(t){const{pinList:e,pinEditorRef:n}=this;e.removeChild(e.childNodes[t]),n.splice(t,1)}render(t){const{info:e,pinList:n,type:i}=this,{nodeId:s,pins:o}=t,r=o.length,d=r!==this.numPins;d&&(this.numPins=r),d&&(0===r&&(e.innerHTML=`no ${i}put`),1===r&&(e.innerHTML=`one ${i}put`),r>1&&(e.innerHTML=`${r} ${i}puts`));for(let t=r;t<n.childElementCount;t++)this.deletePinEditor(t);for(let t=0;t<r;t++){const e=this.pinEditorRef[t],n={nodeId:s,pin:o[t],position:t,type:i};e?e.render(n):this.createPinEditor(n,t)}}}},{"./Component":5,"./InspectorPinEditor":11,"static-props":4}],13:[function(t,e,n){const i=t("bindme"),s=t("static-props"),o=t("./SvgComponent");e.exports=class extends o{constructor(t,e,n){super(t,e,n);const o=this.createElement("div");o.innerHTML="👁",o.style.fontSize=15,o.style.padding=2,i(this,"onMouseEnter"),o.addEventListener("mouseenter",this.onMouseEnter),s(this)({toggle:o})}onMouseEnter(){this.dispatch("showInspector")}render(t){const{toggle:e}=this,n=t.inspector.hidden;this.hidden!==!n&&(this.hidden=!n,e.style.display=n?"":"none")}}},{"./SvgComponent":19,bindme:1,"static-props":4}],14:[function(t,e,n){const i=t("bindme"),s=t("pdsp"),o=t("static-props"),r=t("./SvgComponent");e.exports=class extends r{constructor(t,e,n){super(t,e,n);const s=this.createElementNS("path"),r=this.createElementNS("circle"),d=this.createElementNS("circle");o(this)({end:d,line:s,id:()=>n.getAttribute("id"),start:r,theme:()=>t.theme.link}),i(this,"onClick","onDblclick"),n.addEventListener("click",this.onClick),n.addEventListener("dblclick",this.onDblclick),n.addEventListener("mousedown",this.dropEvent)}onClick(t){s(t);const{id:e,dispatch:n}=this;n("selectLink",e)}onDblclick(t){s(t);const{id:e,dispatch:n}=this;n("deleteLink",e)}render(t){const{canvas:e,line:n,start:i,end:s}=this,{endX:o,endY:r,selected:d,startX:a,startY:h}=t,c=e.theme.pin.size,{baseColor:l,highlightColor:u,width:p}=this.theme,g=o!==this.endX,m=r!==this.endY,f=c!==this.pinSize,b=d!==this.selected,y=a!==this.startX,k=h!==this.startY;p!==this.width&&(this.width=p,n.setAttribute("stroke-width",p)),b&&(this.selected=d,d?(n.setAttribute("stroke",u),i.setAttribute("fill",u),s.setAttribute("fill",u)):(n.setAttribute("stroke",l),i.setAttribute("fill",l),s.setAttribute("fill",l))),y&&(this.startX=a,i.setAttribute("cx",a)),k&&(this.startY=h,i.setAttribute("cy",h)),g&&(this.endX=o,s.setAttribute("cx",o)),m&&(this.endY=r,s.setAttribute("cy",r)),(y||k||g||m)&&n.setAttribute("d",`M ${a} ${h} L ${o} ${r}`),f&&(this.pinSize=c,i.setAttribute("r",c/2),s.setAttribute("r",c/2))}}},{"./SvgComponent":19,bindme:1,pdsp:2,"static-props":4}],15:[function(t,e,n){const i=t("bindme"),s=t("pdsp"),o=t("static-props"),r=t("./SvgComponent"),d=t("./In"),a=t("./Out");class h extends r{constructor(t,e,n,s){super(t,n,s),this.inRef={},this.outRef={};const r=this.createElementNS("rect");r.setAttribute("stroke-width",1);const d=this.createElementNS("rect"),a=this.createElementNS("rect"),h=this.createElementNS("text");h.setAttribute("text-anchor","middle"),i(this,"onMousedown","onMouseup"),s.addEventListener("click",this.dropEvent),s.addEventListener("dblclick",this.dropEvent),s.addEventListener("mousedown",this.onMousedown),s.addEventListener("mouseup",this.onMouseup),o(this)({bottombar:a,container:s,frame:e,label:h,id:()=>s.getAttribute("id"),numIns:()=>Object.keys(this.inRef).length,numOuts:()=>Object.keys(this.outRef).length,rect:r,theme:()=>t.theme.node,topbar:d})}generateInId(t){return`${this.id}-i${t}`}generateOutId(t){return`${this.id}-o${t}`}getInRefByPosition(t){const e=this.generateInId(t);return this.inRef[e]}getOutRefByPosition(t){const e=this.generateOutId(t);return this.outRef[e]}onMousedown(t){const{dispatch:e,id:n}=this;e("selectNode",n)}onMouseup(t){s(t);const{dispatch:e,frame:n}=this;return n.draggingItems?e("stopDraggingItems"):n.draggingLink?e("deleteHalfLink"):void 0}render(t){const{bottombar:e,canvas:n,container:i,dispatch:s,frame:o,id:r,label:h,rect:u,topbar:p}=this,{backgroundColor:g,baseColor:m,highlightColor:f}=this.theme,b=n.theme.pin.size,y=n.theme.frame.fontSize,{connectedIns:k,connectedOuts:x,currentPin:v,draggedLink:E,draggedLinkType:C,draggingLink:L,graph:w,selected:I,textSize:S}=t,{ins:M,outs:A,name:O,x:N,y:R}=Object.assign({},l,w),{height:P,width:T}=c(S,b,w.height,w.width),z=g!==this.backgroundColor,D=y!==this.fontSize,$=b!==this.pinSize,B=P!==this.height,j=O!==this.text,H=M.length!==this.numIns,F=A.length!==this.numOuts,K=I!==this.selected,X=T!==this.width,Y=N!==this.x,q=R!==this.y;(Y||q)&&(this.x=N,this.y=R,i.setAttributeNS(null,"transform",`translate(${N},${R})`)),$&&(this.pinSize=b,e.setAttribute("height",b),p.setAttribute("height",b)),B&&(this.height=P,u.setAttribute("height",P)),(B||$)&&e.setAttribute("transform",`translate(0,${P-b})`),(B||D)&&h.setAttribute("y",Math.round(P/2)+y/3),X&&(this.width=T,e.setAttribute("width",T),h.setAttribute("x",Math.round(T/2)),u.setAttribute("width",T),p.setAttribute("width",T)),j&&(this.name=O,h.textContent=O),z&&(this.backgroundColor=g,u.setAttribute("fill",g)),K&&(this.selected=I,I?(e.setAttribute("fill",f),u.setAttribute("stroke",f),p.setAttribute("fill",f)):(e.setAttribute("fill",m),u.setAttribute("stroke",m),p.setAttribute("fill",m)));for(let t=M.length;t<this.numIns;t++){const e=this.generateInId(t);this.inRef[e].container.remove()}M.forEach((t,e)=>{const i=this.generateInId(e),a=t.type||null,h={connected:k.indexOf(e)>-1,graph:t,highlighted:!!L&&(void 0!==E.from&&C===a),inspected:v&&"In"===v.type&&v.position===e,node:{heightChanged:B,height:P,numPins:M.length,numPinsChanged:H,width:T,widthChanged:X},position:e,selected:I},c=this.inRef[i];if(c)c.render(h);else{const t=this.createElementNS("rect"),a=new d(n,o,s,t,r,e);a.render(h),this.inRef[i]=a}});for(let t=A.length;t<this.numOuts;t++){const e=this.generateOutId(t);this.outRef[e].container.remove()}A.forEach((t,e)=>{const i=this.generateOutId(e),d=t.type||null,h={connected:x.indexOf(e)>-1,graph:t,highlighted:!!L&&(void 0!==E.to&&C===d),inspected:v&&"Out"===v.type&&v.position===e,node:{heightChanged:B,height:P,numPins:A.length,numPinsChanged:F,width:T,widthChanged:X},position:e,selected:I},c=this.outRef[i];if(c)c.render(h);else{const t=this.createElementNS("rect"),d=new a(n,o,s,t,r,e);d.render(h),this.outRef[i]=d}})}}function c(t,e,n,i){const s=t.height+2*e,o=t.width+e;return{height:"number"==typeof n?Math.max(n,s):s,width:"number"==typeof i?Math.max(i,o):o}}const l={name:"Node",ins:[],outs:[]};o(h)({computeDims:c,defaultGraph:l}),e.exports=h},{"./In":9,"./Out":16,"./SvgComponent":19,bindme:1,pdsp:2,"static-props":4}],16:[function(t,e,n){const i=t("bindme"),s=t("pdsp"),o=t("static-props"),r=t("./Pin");e.exports=class extends r{constructor(t,e,n,s,r,d){super(t,e,n,s,r,d),o(this)({y:()=>parseInt(s.getAttribute("y"))}),i(this,"onMousedown","onMouseover","onMouseup"),s.addEventListener("mousedown",this.onMousedown),s.addEventListener("mouseover",this.onMouseover),s.addEventListener("mouseup",this.onMouseup)}onMousedown(t){s(t);const{dispatch:e,frame:n,nodeId:i,position:o}=this;n.setCursorCoordinates(t),e("createHalfLink",{cursorCoordinates:n.cursorCoordinates,from:[i,o],type:this.graph.type||null})}onMouseover(t){s(t);const{dispatch:e,nodeId:n,position:i}=this;e("focusPin",{type:"Out",nodeId:n,position:i})}onMouseup(t){s(t);const{dispatch:e,highlighted:n,frame:i,nodeId:o,position:r}=this;i.draggingLink&&i.draggedLink.to&&(n?e("attachHalfLink",{id:i.draggedLinkId,from:[o,r]}):e("deleteHalfLink"))}render(t){super.render(t);const{container:e,size:n}=this,{node:i}=t;i.heightChanged&&e.setAttribute("y",i.height-n)}}},{"./Pin":17,bindme:1,pdsp:2,"static-props":4}],17:[function(t,e,n){const i=t("bindme"),s=t("static-props"),o=t("./SvgComponent");e.exports=class extends o{constructor(t,e,n,o,r,d){super(t,n,o),i(this,"onMouseleave"),o.addEventListener("mouseleave",this.onMouseleave),o.addEventListener("click",this.dropEvent),s(this)({frame:e,nodeId:r,position:d,theme:()=>t.theme.pin,x:()=>parseInt(o.getAttribute("x"))})}onMouseleave(){this.dispatch("blurPin")}render(t){const{container:e,theme:n}=this,{size:i}=n,{connected:s,graph:o,highlighted:r,inspected:d,node:a,position:h,selected:c}=t;this.connected=s,this.graph=o;const l=r!==this.highlighted,u=d!==this.inspected,p=c!==this.selected,g=i!==this.size;if(a.widthChanged||a.numPinsChanged)if(0===h)e.setAttribute("x",0);else{const t=h*(a.width-i)/(a.numPins-1);e.setAttribute("x",t)}g&&(this.size=i,e.setAttribute("height",i),e.setAttribute("width",i)),l&&(this.highlighted=r),u&&(this.inspected=d),p&&(this.selected=c),(l||u||p)&&(d?e.setAttribute("fill",n.inspectedColor):c?e.setAttribute("fill",n.highlightColor):r&&!s?e.setAttribute("fill",n.highlightColor):e.setAttribute("fill",n.baseColor))}}},{"./SvgComponent":19,bindme:1,"static-props":4}],18:[function(t,e,n){const i=t("bindme"),s=t("static-props"),o=t("./Component"),r=t("./Frame"),d=t("./Inspector");e.exports=class extends o{constructor(t,e,n){super(t,e,n),this.nodeName={},this.textSize={},n.style.display="flex";const o=this.createElement("div");o.style.height="auto",o.style.width="auto",o.style.position="absolute",o.style.visibility="hidden",o.style.whiteSpace="nowrap";const a=this.createElement("div"),h=new d(t,e,a),c=new r(t,e,n);s(this)({boundingRect:()=>n.getBoundingClientRect(),textRuler:o}),s(this.component)({frame:c,inspector:h}),i(this,"onContainerMutations"),new MutationObserver(this.onContainerMutations).observe(n,{attributes:!0})}onContainerMutations(t){for(let e of t)"attributes"===e.type&&"style"===e.attributeName&&this.dispatch("resize",this.boundingRect)}render(t){const{canvas:e,nodeName:n,textRuler:i,textSize:s}=this,{graph:o}=t,{fontFamily:r,fontSize:d}=e.theme.frame;(this.fontSize!==d||this.fontFamily!==r)&&(i.style.fontFamily=r,i.style.fontSize=d);let a=[];o.nodes.forEach(({id:t,name:e})=>{a.push(t),n[t]?e!==n[t].name&&(n[t]=e,s[t]=this.sizeOfText(e)):(n[t]=e,s[t]=this.sizeOfText(e))}),Object.keys(n).forEach(t=>{-1===a.indexOf(t)&&(delete this.nodeName[t],delete this.textSize[t])}),this.renderAllSubComponents(Object.assign({},t,{textSize:s}))}sizeOfText(t){const{textRuler:e}=this;return e.textContent=t,{height:e.clientHeight,width:e.clientWidth}}}},{"./Component":5,"./Frame":8,"./Inspector":10,bindme:1,"static-props":4}],19:[function(t,e,n){const i=t("static-props"),s=t("./Component");e.exports=class extends s{constructor(t,e,n){super(t,e,n),i(this)({namespaceURI:"http://www.w3.org/2000/svg"})}createElementNS(t,e){const n=document.createElementNS(this.namespaceURI,t);return e?e.appendChild(n):this.container.appendChild(n),n}}},{"./Component":5,"static-props":4}],20:[function(t,e,n){e.exports=function(t){const e=()=>{const e=localStorage.getItem(t);return e?JSON.parse(e):e};return{assign:n=>{const i=e();i?localStorage.setItem(t,JSON.stringify(Object.assign(i,n))):localStorage.setItem(t,JSON.stringify(n))},getItem:e}}},{}],"flow-view":[function(t,e,n){(function(i){const s=t("static-props"),o=t("./localStored"),r=t("./Creator"),d=t("./Inspector"),a=t("./Root");class h{constructor(t){this.theme={frame:{fontFamily:"Courier",fontSize:14},inspector:{baseColor:"gainsboro"},link:{baseColor:"darkgray",highlightColor:"mediumaquamarine",width:2},node:{backgroundColor:"white",baseColor:"gainsboro",highlightColor:"#A9DFBF"},pin:{baseColor:"darkgray",highlightColor:"mediumaquamarine",inspectedColor:"mediumseagreen",size:8},selection:{color:"#A9DFBF"}},this.state={creator:Object.assign({},r.defaultState),currentPin:null,draggingItems:!1,draggingLink:!1,draggedLinkCoordinates:null,draggedLinkId:null,draggedLinkType:null,graph:{links:[],nodes:[]},inspector:Object.assign({},d.defaultState,o("inspector").getItem()),multiSelection:!1,selected:{links:[],nodes:[]}};let e=Function.prototype;const n=new a(this,(h=this,function(t,n){"production"!==i.env.NODE_ENV&&console.time(t);try{h[t](n)}catch(e){throw console.error(`action ${t}`),e}e(h.state),"production"!==i.env.NODE_ENV&&console.timeEnd(t)}),t);var h;this.state.root=n.boundingRect,e=n.render.bind(n),s(this)({root:n})}blurPin(){this.state.currentPin=null}attachHalfLink({id:t,from:e,to:n}){const i=this.state.graph.links.findIndex(e=>e.id===t);i>-1&&(e?this.state.graph.links[i].from=e:n&&(this.state.graph.links[i].to=n),this.state.draggingLink=null,this.state.draggedLinkCoordinates=null,this.state.draggedLinkId=null,this.state.draggedLinkType=null)}createHalfLink(t){const e=this.generateId();this.state.draggingLink=!0,this.state.draggedLinkCoordinates=t.cursorCoordinates,this.state.draggedLinkId=e,this.state.draggedLinkType=t.type,this.state.graph.links.push({id:e,from:t.from,to:t.to}),this.resetSelection()}createInputPin(){}createLink(t){t.id=this.generateId(),this.state.graph.links.push(t)}createNode(t){t.id=this.generateId(),this.state.graph.nodes.push(t),this.hideCreator()}createOutputPin(){}deleteHalfLink(){const t=this.state.draggedLinkId;this.state.draggingLink=null,this.state.draggedLinkCoordinates=null,this.state.draggedLinkId=null,this.state.draggedLinkType=null;const e=this.state.graph.links.findIndex(({id:e})=>e===t);this.state.graph.links.splice(e,1)}deleteLink(t){const{links:e}=this.state.graph,n=e.findIndex(({id:e})=>e===t);e.splice(n,1)}deleteNode(t){const{links:e,nodes:n}=this.state.graph,i=n.findIndex(({id:e})=>e===t);n.splice(i,1),e.reduce((e,n)=>{const{from:i,to:s}=n;return i&&i[0]===t||s&&s[0]===t?e.concat(n.id):e},[]).forEach(t=>this.deleteLink(t))}deleteInputPin(){}deleteOutputPin(){}deleteView(){}deleteSelection(){const{links:t,nodes:e}=this.state.selected;t.forEach(t=>this.deleteLink(t)),e.forEach(t=>this.deleteNode(t)),this.resetSelection()}deselectNode(t){const e=this.state.selected.nodes.indexOf(t);e>-1&&this.state.selected.nodes.splice(e,1),this.hideCreator()}deletePin({type:t,nodeId:e,position:n}){const{links:i,nodes:s}=this.state.graph,o=s.findIndex(t=>t.id===e);this.state.graph.nodes[o][`${t}s`].splice(n,1),i.reduce((t,i)=>{const{from:s,to:o}=i;return s&&s[0]===e&&s[1]===n||o&&o[0]===e&&o[1]===n?t.concat(i.id):t},[]).forEach(t=>this.deleteLink(t))}disableMultiSelection(){this.state.multiSelection=!1}dragItems({x:t,y:e}){const{graph:n,selected:i}=this.state;n.nodes.filter(({id:t})=>i.nodes.indexOf(t)>-1).forEach(n=>{n.x+=t,n.y+=e})}dragLink(t){this.state.draggedLinkCoordinates=t}enableMultiSelection(){this.state.multiSelection=!0}focusPin(t){this.state.currentPin=t}generateId(){let t="";for(;t.length<3;)t+=String.fromCharCode(97+Math.floor(26*Math.random()));return t}hideCreator(){this.state.creator.hidden=!0}hideInspector(){this.state.inspector.hidden=!0,o("inspector").assign({hidden:!0})}loadGraph(t){this.state.graph=t,this.root.render(this.state)}pinInspector(){this.state.inspector.pinned=!0,o("inspector").assign({pinned:!0})}renameNode({id:t,name:e}){const{nodes:n}=this.state.graph;n[n.findIndex(e=>e.id===t)].name=e}renamePin({type:t,nodeId:e,position:n,name:i}){const{nodes:s}=this.state.graph,o=s.findIndex(t=>t.id===e);this.state.graph.nodes[o][`${t}s`][n].name=i}resize(t){this.state.root=t}selectLink(t){const{graph:e,multiSelection:n,selected:i}=Object.assign({},this.state);-1===i.links.indexOf(t)&&(n?i.links.push(t):(this.resetSelection(),i.links=[t])),this.state.graph.links=e.links,this.state.selected.links=i.links,this.hideCreator()}selectNode(t){const{graph:e,multiSelection:n,selected:i}=Object.assign({},this.state);-1===i.nodes.indexOf(t)&&(n?i.nodes.push(t):(this.resetSelection(),i.nodes=[t])),this.state.graph.nodes=e.nodes,this.state.selected.nodes=i.nodes,this.hideCreator()}resetSelection(){this.state.selected={links:[],nodes:[]},this.hideCreator(),this.stopDraggingItems()}showCreator({x:t,y:e}){this.state.creator={hidden:!1,x:t,y:e}}showInspector(){this.state.inspector.hidden=!1,o("inspector").assign({hidden:!1})}startDraggingItems(){this.state.draggingItems=!0}stopDraggingItems(){this.state.draggingItems=!1}unpinInspector(){this.state.inspector.pinned=!1,o("inspector").assign({pinned:!1})}}e.exports={Canvas:h},n.default={FlowViewCanvas:h}}).call(this,t("_process"))},{"./Creator":6,"./Inspector":10,"./Root":18,"./localStored":20,_process:3,"static-props":4}]},{},[]);